import { findFirstPair, getMatches } from '../helper';

describe('Bug on create regexp:', () => {
  test('duplicates_search results', () => {
    const start = '(בעל הסולם, "הקדמה לספר';
    const end   = 'הזוהר", אות ס"ט) 12';
    const data  = '  החיוב בלימוד חכמת הקבלה    1. למה זה חייבו המקובלים, לכל איש, ללמוד חכמת הקבלה?    אומנם יש בזה דבר גדול, וראוי לפרסמו: כי יש סגולה נפלאה לאין ערוך, לעוסקים בחכמת הקבלה, ואע"פ שאינם מבינים מה שלומדים, אלא מתוך החשק והרצון החזק, להבין מה שלומדים, מעוררים עליהם את האורות המקיפים את נשמתם.    פירוש: כי כל אדם מישראל, מובטח בסופו, שישיג כל ההשגות הנפלאות, אשר חשב השי"ת במחשבת הבריאה ליהנות לכל נברא. אלא, מי שלא זכה בגלגול זה, יזכה בגלגול ב\' וכו\', עד שיזכה להשלים מחשבתו יתברך, שחשב עליו. (בעל הסולם, "הקדמה לתלמוד עשר הספירות", אות קנ"ה)    2. הנה נודע מפי סופרים ופי ספרים, אשר לימוד חכמת הקבלה הוא מחויב בהחלט לכל אדם מישראל. ולו למד אדם כל התורה כולה, ובקי בש"ס ופוסקים בעל פה, גם ממולא במידות ובמעשים טובים יותר מכל בני דורו, ולא למד חכמת הקבלה, הוא מחויב להתגלגל ולבוא עוד פעם בעולם הזה, כדי ללמוד רזי תורה וחכמת האמת, שזהו מובא בכמה מקומות במדרשי חז"ל. (בעל הסולם, "הקדמת פי חכם")    3. אי אפשר שכל כלל ישראל יבואו לטוהרה גדולה, זולת על ידי לימוד הקבלה, שהיא הדרך הקלה ביותר, המספיקה גם לקטני הדעת.    מה שאם כן בדרך העסק בתורת הנגלה בלבד, אי אפשר לזכות על ידה, זולת ליחידי סגולה, ועל ידי יגיעה רבה, אבל לא למרבית העם. (בעל הסולם, "הקדמה לתלמוד עשר הספירות", אות ל"ו)    4. כלל האנושיות, המתחייבת בסופה, בהכרח ובחיוב מוחלט, לבוא עד לידי ההתפתחות המופלגה הזאת, כמו שכתוב "ומלאה הארץ דעה את ה\', כמים לים מכסים" (ישעיהו י"א), "ולא ילמדו עוד איש את רעהו, ואיש את אחיו, לאמר, דעו את ה\', כי כולם ידעו אותי, למקטנם ועד גדלם" (ירמיהו ל"א), ואומר "ולא יכנוף עוד מורך, והיו עיניך רואות את מוריך" (ישעיהו ל\'). (בעל הסולם, "מהותה של חכמת הקבלה")    5. כל בני העולם יתחברו ויוכשרו לעבודתו יתברך. (בעל הסולם, אגרת נ"ה)    6. כל אדם מחויב להשיג שורש נשמתו. (בעל הסולם, "שכל הפועל")    7. לזכייה גדולה אנו צריכים להבין בפשטי המקראות, להיותנו מחויבים להשיג מקודם ג\' החלקים שבפנימיות התורה, אשר הפשט מלביש אותם, והפשט לא יופשט.    ולהוציא מטענת המתרשלים בהשגת הפנימיות, ואומרים בליבם: דיינו בהשגת הפשט. והלוואי שנשיג אותה, והיינו שמחים בחלקנו. שדבריהם דומים למי שרוצה לעלות על המדרגה הרביעית, בטרם שיפסע על ג\' מדרגות הראשונות. (בעל הסולם, הקדמה לספר "פנים מאירות ומסבירות", אות א\')    8. אומר לך, אשר שמעתי, מהאדמו"ר מקאלשין. שבימים הראשונים היה צורך להקדים להשגת ה\' כל שבע החכמות החיצוניות, המכונים "שבע נערות המשמשות לבת מלך", ולסיגופים נוראיים. ועם כל זה לא הרבה היו זוכים למציאת חן בעיניי הבורא. אולם, מעת שזכינו ללימוד האר"י ז"ל, ולעבדות הבעש"ט, הוא באמת דבר השווה לכל אדם, ואינם צריכים עוד הכנות הנ"ל. (בעל הסולם, אגרת ל"ח)    9. מעתה מוטל רק עלינו, שארית הפליטה, לתקן את המעוות החמור הזה, וכל אחד ואחד מאיתנו, שרידי הפליטה, יקבל על עצמו, בכל נפשו ומאודו, להגביר מכאן ואילך את פנימיות התורה וליתן לה את מקומה הראוי, כחשיבותה על מעלת חיצוניות התורה. (בעל הסולם, "הקדמה לספר הזוהר", אות ע"א)    10. עתה רבותיי, הרי לפניכם ערוך ומוטל בארון זה הספר, שבו כתוב ומפורש כל חכמת המדינות וכל סדרי היחיד והציבור אשר יהיו בסוף הימים, דהיינו הספרי קבלה, שבו מסודרים העולמות המתוקנים שיצאו עם השלימות, כנ"ל שמהשי"ת יוצא השלימות בראשונה, אחר כך אנו מתקנים אותם ובאים לשלימות המונח וקיים בעולם העליון, היוצא מאין סוף ב"ה, בדרך: סוף מעשה - במחשבה תחילה ומטעם שמהשלם לא נמשך תיכף בלתי שלם אלא בדרך הדרגה ואין העדר ברוחני, ועל כן נשארים כולם קיימים ומצויירים בכל דמויים וצלמם בכללות ופרטות בחכמת הקבלה.    פיתחו הספרים הללו ותמצאו כל סדרים הטובים שיתגלו באחרית הימים, ומתוכם תקבלו הלקח הטוב איך לסדר הדברים גם היום כדרכיכם בענייני העולם הזה, שאפשר ללמוד את היסטוריה העוברת וממנה אנו מתקנים את היסטוריה הבאה. (בעל הסולם, "כתבי הדור האחרון")    11. גאולת ישראל וכל מעלת ישראל תלוי בלימוד הזוהר ובפנימיות התורה. (בעל הסולם, "הקדמה לספר הזוהר", אות ס"ט)    12. מתוך שחכמת הקבלה כולה, מדברת בסוד התגלות ה\', מובן מאליו, שאין לך חכמה חשובה ומוצלחת לסגולתה, כמותה. ואל זה כוונו בעלי הקבלה, לסדרה שתהיה ראויה להתעסק בה. וכן ישבו ועסקו בה, עד זמן הגניזה (ומסיבה ידועה הוסכם לגנזה), מכל מקום היה זה רק לזמן ידוע ולא חס ושלום לתמיד, כמו שכתוב בזוהר: "עתידה חכמתא דא לאתגליא בסוף יומיא, ואפילו לטליא דבי רב (עתידה חכמה זו להתגלות בסוף הימים, ואפילו לתינוקות של בית רבן)" עיין שם היטב. (בעל הסולם, "תורת הקבלה ומהותה")    13. מוכרח כל אדם, בשעת העסק בתורה, להתייגע בה, וליתן דעתו וליבו, למצוא בה את אור "פני" מלך חיים, דהיינו, השגת ההשגחה הגלויה, שנקראת "אור הפנים", כנ"ל ד"ה "ומתחילה".    וכל אדם מוכשר לזה, כמו שכתוב: "ומשחרי ימצאונני". וכמו שכתוב: "יגעתי ולא מצאתי, אל תאמין". וכלום חסר לו לאדם בדבר זה, רק היגיעה בלבדה. (בעל הסולם, "הקדמה לתלמוד עשר הספירות", אות צ"ז)    14. גילוי חכמת הנסתר בהמון גדול, הוא תנאי מוקדם ומחויב לבוא בטרם הגאולה השלימה. (בעל הסולם, "שופר של משיח")    15. כתוב בזוהר, שבחיבור הזה ייצאו בני ישראל מהגלות, וכן עוד בהרבה מקומות, שאך ורק בהתפשטות חכמת הקבלה ברוב עם, נזכה לגאולה השלימה. וכן אמרו ז"ל, המאור שבה מחזירו למוטב, ודקדקו זה בכוונה גדולה, להורותינו שרק המאור שבתוכיותה, כתפוחי זהב במשכיות כסף בה צָרוּר זו הסגולה, להחזיר האדם למוטב, שהן היחיד והן האומה, לא ישלימו הכוונה שעליה נבראו, זולת בהשגת פנימיות התורה וסודותיה. (בעל הסולם, הקדמה לספר "פנים מאירות ומסבירות", אות ה\')    16. להתפשטות גדולה של חכמת האמת בקרב העם, אנו צריכים מקודם, באופן שנהיה ראויים לקבל התועלת ממשיח צדקנו. ולפיכך תלויים המה התפשטות החכמה וביאת משיח צדקנו זה בזה. וכיוון שכן, הרי אנו מחויבים לקבוע מדרשות ולחבר ספרים, כדי למהר תפוצת החכמה במרחבי האומה. (בעל הסולם, הקדמה לספר "פנים מאירות ומסבירות", אות ה\')    17. סודות אלו, לא רק שאין איסור לגלותם, אלא אדרבה, מצווה גדולה לגלותם (פסחים קי"ט). ומי שיודע לגלות ומגלה אותם, שכרו הרבה מאוד. כי בגילוי האורות הללו לרבים, ולרבים דווקא, תלוי דבר ביאת גואל צדק, במהרה בימינו אמן. (בעל הסולם, "הקדמה לתלמוד עשר הספירות", אות ל\')    18. יש חיוב מוקדם לגאולה, אשר כל אומות העולם יודו לתורת ישראל בסוד הכתוב "ומלאה הארץ דעה", דוגמת יציאת מצרים, שהיה חיוב מוקדם, שגם פרעה יודה לאלוקים אמת ולמצוותיו וירשה להם לצאת. ועל כן כתוב, שכל אחד מהאומות יחזיק באיש יהודי ויוליכהו לארץ הקדושה, ואינו מספיק מה שיוכלו לצאת מעצמם. ותבין אומנם, מהיכן יבוא לאומות העולם דעת ורצון כזאת.    תדע, שהוא על ידי הפצת החכמה האמיתית, שיראו בעליל אלוקים אמת ותורת אמת. והפצת החכמה בהמון מכונה שופר, דוגמת השופר שקולו הולך עד למרחק המרובה, כן יתפשט הד החכמה בכל העולם, שאפילו האומות ישמעו ויודו, כי יש חכמת אלוקים בקרב ישראל. (בעל הסולם, "שופר של משיח")    19. זה זמן רב, אשר מוסר כליותיי ירדפני יום יום, לצאת מגדרי ולחבר איזה חיבור יסודי בדבר נשמת היהדות והדת, ובידיעת מקוריות חכמת הקבלה, ולהפיצו בקרב העם, באופן שישיגו מתוכו היכרות והבנה בכלל הדברים העומדים ברומו של עולם, כראוי, באופיים וצביונם האמיתי. (בעל הסולם, "עת לעשות")    20. צריך תמיד לזכור את הסיבה, המחייבו לעסוק בתורה ומצוות. וזה עניין שדרשו חז"ל "שתהיה קדושתכם לשמי", שפירושו, שאני אהיה הגורם שלכם. שזה נקרא, שכל עבודתכם הוא בזה, שאתם רוצים ליהנות לי, היינו שכל מעשיכם יהיו בעל מנת להשפיע.    כדברי חז"ל "כל שישנו בשמירה ישנו בזכירה" (ברכות כ\'). שפירושו הוא, כל אלה, שעוסקים בשמירת תורה ומצוות על הכוונה בכדי להגיע לזכירה, בסוד "בזוכרי בו, איננו מניח לי לישון", נמצא, שעיקר השמירה הוא, בכדי לזכות לזכירה.    זאת אומרת, זה שרוצה לזכור את הבורא, זה הוא הגורם שמירת תורה ומצוות. היות לפי זה, הסיבה והגורם, שצריך לשמור את התורה ומצוות, הוא הבורא. היות בלי זה אין האדם יכול להתדבק בהבורא, מטעם ש"אין אני והוא יכולים לדור במדור אחד", מסיבת שינוי צורה כידוע. (בעל הסולם, "שמעתי", מאמר ל"ח, "יראת ה\' הוא אוצרו")    21. קל יותר להמשיך המאור שבתורה בעסק ויגיעה בחכמת האמת, מאשר ביגיעה בתורת הנגלה. והטעם הוא פשוט מאוד, כי חכמת תורת הנגלה לבושה בלבושים חיצוניים גשמיים, דהיינו גניבה, גזילה ונזיקין וכדומה, אשר משום זה קשה וכבד מאוד לכל אדם לכוון דעתו וליבו לה\' בעת העסק, כדי להמשיך המאור שבתורה.    כל שכן לאיש כזה, שהוא כבד וקשה בעיון התלמוד עצמו. ואיך יוכל להיזכר עוד בשעת הלימוד בה\', כי להיות העיון הוא בנושאים גשמיים, הם חלילה אינם יכולים לבוא אצלו עם הכוונה לה\' בבת אחת.    ולכן מייעצו לעסוק בחכמת הקבלה, אשר חכמה זו לבושה כולה בשמותיו של הקב"ה, ואז כמובן יוכל לכוון דעתו וליבו לה\' בשעת לימוד, בלי טורח, ואפילו קשה העיון ביותר. כי העיון בנושאים של החכמה וה\' הם אחד. (בעל הסולם, "הקדמה לתלמוד עשר הספירות", אות כ"ב)    22. כל חלק התורה הנגלה, אינו אלא בחינת הכנה, שנהיה ראויים וכדאיים להשיג חלק הנסתר, אשר חלק הנסתר הוא עצם השלימות והתכלית, שעליו נברא האדם. אם כן ודאי וברור, שאם חסר מחלק הנסתר אע"פ ששמר התורה וקיים מצוותיה בחלק הנגלה, מחויב עוד להתגלגל ולבוא לעולם לקבל מה שראוי לקבל, דהיינו חלק הנסתר על דרך תרי"ג פקודין כנ"ל, שאך בזה נשלמת הנשמה, כמו שחשב עליה ה\' מכל מראש.    והינך רואה חיוב המוחלט, המוטל על כל ישראל, יהיה מי שיהיה, לעסוק בפנימיות התורה ובסודותיה, שלא תושלם באדם כוונת הבריאה זולתה. ולסיבה זו אנו מתגלגלים, דור יוצא ודור בא, עד דורנו זה שהוא השארית של הנשמות, שעדיין לא נשלמה עליהן כוונת הבריאה, מפני שלא זכו להשיג בדורות שעברו עליהן את סודות התורה, כנ"ל בזוהר, ועל כן אמרו בזוהר "עתידין רזי תורה וסודותיה שיתגלו לעקבתא דמשיחא", שזהו ברור לכל מבין, מחמת שהמה תהיינה משלימות הכוונה בבריאה, דעל כן תזכינה לביאת המשיח, ואם כן על כורחך שיגולו ביניהן סודות התורה באתגליא, דבלאו הכי (שבלי זה) נמנע התיקון. (בעל הסולם, "הקדמת פי חכם")    23. צריך להבין מאוד מאוד, שזה עניין של הגאולה, וביאת המשיח המקווה לנו במהירה בימינו אמן, הוא עניין תכלית הגובה של שלימות ההשגה והדעת כמו "ש"ולא ילמדו עוד איש את רעהו לדעת את ה\' כי כולם ידעו אותי מגדלם ועד קטנם וכו\'", אלא שעם שלימות הדעת נשלמים גם הגופות כמו שכתוב ישעיהו ס"ה, הנער בן מאה שנה ימות וכו\' וכאשר יושלמו בני ישראל, עם דעת השלם יתגברו מעיינות התבונה והדעת מעל לגבול ישראל וישקו לכל אומות העולם, כמו שכתוב ישעיהו י"א "כי מלאה הארץ דעה את ה\'" וכמו "ש וינהרו אל ה\' ואל טובו וכו\' והתגברות הדעת הזה הוא עניין התפשטות מלכות המשיח אל כל האומות ולאפוקי מהמון עם גסי החומר, שלהיות דמיונם דבוק בשלימות כוח האגרוף, ועל כן נחקק בדמיונם, עניין התפשטות מלכות ישראל על האומות, אך ורק במין שליטה הנוהג מגופות על גופות, ליטול שכרם משלם בגאווה גדולה, להתגאות על כל בני חלד, ומה אעשה להם אם כבר חז"ל דחו כל אותם, וכמותם מקהל ה\', באמרם כל המתגאה אומר הקב"ה אין אני והוא יכולים לדור במדור אחד. (בעל הסולם, הקדמה לספר "פנים מאירות ומסבירות", אות ד\')    24. היבשות והחשכות, שמצאונו בדורנו זה, שלא נשמע כמוהן, בכל הדורות שקדמו לנו, שהוא משום, שאפילו העובדי ה\', שמטו ידיהם מהעסק בסודות התורה.    וכבר המשיל הרמב"ם ז"ל, משל אמיתי על זה, ואמר, שאם שורה, של אלף אנשים סומים, הולכים בדרך, ויש להם לפחות, פקח אחד בראשם, הרי הם בטוחים כולם, שילכו בדרך הישר, ולא יפלו בפחים ומכמורות, להיותם נמשכים אחר הפקח, שבראשם.  …';

    const result = getMatches(data, start, end);
    expect(result).not.toBeNull();
  });

  test('functionality of findFirstPair', () => {
    const starts   = [{ index: 50 }, { index: 1000 }, { index: 1500 }];
    const ends     = [{ index: 30 }, { index: 1100 }, { index: 1500 }];
    const expected = { start: 1000, end: 1100 };

    const result = findFirstPair(starts, ends);
    expect(result).not.toBeNull();

    expect(result.start).not.toBeNull();
    expect(result.end).not.toBeNull();

    expect(result.start.index).toEqual(expected.start);
    expect(result.end.index).toEqual(expected.end);
  });

  test('findFirstPair_no_pair', () => {
    const starts = [{ index: 50 }, { index: 1000 }, { index: 1500 }];
    const ends   = [{ index: 30 }];

    const result = findFirstPair(starts, ends);
    expect(result).not.toBeNull();
    expect(result.end).toBeNull();
  });

});
